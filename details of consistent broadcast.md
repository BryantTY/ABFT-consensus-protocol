## How We Built It: Detailed Implementation of the Consensus Protocol

Our consensus protocol is viewed from the perspective of a consensus $node_i$, one of $n$ consensus nodes, each uniquely identified. The protocol integrates four sub-protocols: Consistency Broadcast (CBC), Strong Provable Broadcast (SPB), Leader Selection (LS), and Speed Validated Agreement (SVA). Drawing on Dumbo_NG's parallel-running strategy, our protocol enables concurrent operation.

CBC Instance Execution:
1) Each consensus $node_i$ generates a batch of transactions ($M_i$), simulating its transaction pool content.
2) $Node_i$ encodes $M_i$ into $n$ shards $m_j$ ($j$ ranges from 0 to n-1) using the erasure coding encoding algorithm (ECen). It then inputs these shards into a Merkle tree formulation function, producing a Merkle tree and a proof (Merkle tree branch) for each shard $m_j$. $Node_i$ sends a message $(i, ($'CBC_SEND'$, roothash, branch, m_j, i_1))$ to $Node_j$, where 'CBC_SEND' is the message tag, $roothash$ is the Merkle tree's root hash, and $i_1$ denotes the first CBC instance of $node_i$.
3) When $node_i$ receives a 'CBC_SEND' message from $node_j$ $(j, ($'CBC_SEND'$, roothash, branch, m_i, j_1))$, it first checks if it has already received the message. It then verifies the branch's (proof) validity using a dedicated function. If valid, $node_i$ signs the message using ecdsa_sign() to generate a signature $Sig_i[j_1]$ and sends $(i, ($'CBC_ECHO'$, j_1, Sig_i[j_1], roothash))$ back to $node_j$.
4) Receiving a 'CBC_ECHO' message for its $i_1-th$ CBC instance from $node_j$, $node_i$ checks the message's validity using ecdsa_vrfy($PK[j]$, $roothash$, $Sig_j[i_1]$). If valid, it stores the  $Sig_j[i_1]$ in a set $cbc.echo.sshares[i_1]$. Once $node_i$ accumulates $2f+1$ valid signatures in $cbc.echo.sshares[i_1]$, it generates a new transaction batch and repeats steps 1) and 2). The difference in step 2) is that 'CBC_SEND' now includes "$cbc.echo.sshares[i_1]$", leading $node_i$ to send $(i, ($'CBC_SEND'$, roothash, branch, m_j, cbc.echo.sshares[i_1], i_2)$ to $node_j$ for its $2th$ CBC instance. 
